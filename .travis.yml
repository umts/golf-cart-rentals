language: ruby
env: "CODECLIMATE_REPO_TOKEN=15ed3ea3aa5e152f478928dbb01e5747253e54be2b90553170931dbc842428c7"
rvm: 2.2.3
script:
#  - xvfb-run -a bundle exec rspec spec/features/*.rb
  - bundle exec rspec spec/features/*.rb
  - bundle exec rspec --exclude-pattern "spec/features/*.rb" spec/
# Try using xvfb {command} instead of xvfb-run
before_install:
 - sudo apt-get update
 - sudo apt-get install chromium-chromedriver
 - gem install rack
# - "/sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 1280x1024x16"
before_script:
  - cp config/inventory_api_keys.travis.yml config/inventory_api_keys.yml
  - cp config/database.travis.yml config/database.yml
  - rm config/environments/development.rb
  - rm config/environments/test.rb
  - cp -f config/environments/development.travis.rb config/environments/development.rb
  - cp -f config/environments/test.travis.rb config/environments/test.rb
  - bundle exec rake db:create
  - bundle exec rake db:migrate
  - bundle exec rake db:seed
  - export TZ="America/New_York"
  - export PATH=$PATH:/usr/lib/chromium-browser/
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start
  # - bundle exec rackup -p 5000 &
  # - sleep 3 # give rackup time to start
addons:
  code_climate:
    repo_token: 15ed3ea3aa5e152f478928dbb01e5747253e54be2b90553170931dbc842428c7
after_success:
  - bundle exec codeclimate-test-reporter
